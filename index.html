<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aircraft Game</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    canvas {
      background: url("assets/background.png") repeat-y center/cover;
      display: block;
      width: 100vw;
      height: 75vh;
      position: relative;
      box-shadow: 0 -10vh 0 black inset, 0 10vh 0 black inset;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // set fixed aspect for mobile view
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.75;

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight * 0.75;
    });

    const playerImg = new Image();
    playerImg.src = "assets/player.png";

    const enemyImg = new Image();
    enemyImg.src = "assets/enemy.png";

    const bulletImg = new Image();
    bulletImg.src = "assets/bullet_green.png";

    const enemyBulletImg = new Image();
    enemyBulletImg.src = "assets/bullet_red.png";

    const powerImgs = [
      "assets/power_double_fire.png",
      "assets/power_shield.png",
      "assets/power_extra_life.png"
    ].map(src => {
      const img = new Image();
      img.src = src;
      return img;
    });

    const player = {
      x: canvas.width / 2 - 25,
      y: canvas.height - 80,
      width: 50,
      height: 50,
      speed: 8
    };

    const bullets = [];
    const enemies = [];
    const enemyBullets = [];
    const powers = [];

    let lastEnemySpawn = 0;
    let lastEnemyShot = 0;
    let lastPowerSpawn = 0;

    function spawnEnemy() {
      const enemy = {
        x: Math.random() * (canvas.width - 50),
        y: -50,
        width: 50,
        height: 50,
        speed: 2
      };
      enemies.push(enemy);
    }

    function spawnPower() {
      const power = {
        x: Math.random() * (canvas.width - 40),
        y: -40,
        width: 40,
        height: 40,
        speed: 1.5,
        img: powerImgs[Math.floor(Math.random() * powerImgs.length)]
      };
      powers.push(power);
    }

    function drawPlayer() {
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
    }

    function drawEnemies() {
      enemies.forEach(enemy =>
        ctx.drawImage(enemyImg, enemy.x, enemy.y, enemy.width, enemy.height)
      );
    }

    function drawBullets() {
      bullets.forEach(bullet =>
        ctx.drawImage(bulletImg, bullet.x, bullet.y, bullet.width, bullet.height)
      );
    }

    function drawEnemyBullets() {
      enemyBullets.forEach(b =>
        ctx.drawImage(enemyBulletImg, b.x, b.y, b.width, b.height)
      );
    }

    function drawPowers() {
      powers.forEach(p =>
        ctx.drawImage(p.img, p.x, p.y, p.width, p.height)
      );
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Player Movement
      document.onkeydown = function(e) {
        if (e.key === "ArrowLeft" && player.x > 0) player.x -= player.speed;
        if (e.key === "ArrowRight" && player.x + player.width < canvas.width)
          player.x += player.speed;
      };

      // Bullets update
      bullets.forEach(b => b.y -= 6);
      bullets.filter(b => b.y > 0);

      // Enemy update
      enemies.forEach(e => e.y += e.speed);

      // Enemy bullets update
      enemyBullets.forEach(b => b.y += 3);

      // Powers update
      powers.forEach(p => p.y += p.speed);

      // Draw everything
      drawPlayer();
      drawEnemies();
      drawBullets();
      drawEnemyBullets();
      drawPowers();

      // Spawn enemy (slow rate)
      if (Date.now() - lastEnemySpawn > 2500) {
        spawnEnemy();
        lastEnemySpawn = Date.now();
      }

      // Enemy fire latency (slow rate)
      if (Date.now() - lastEnemyShot > 1800) {
        enemies.forEach(e => {
          enemyBullets.push({
            x: e.x + e.width / 2 - 5,
            y: e.y + e.height,
            width: 10,
            height: 20
          });
        });
        lastEnemyShot = Date.now();
      }

      // Power spawn (spread randomly)
      if (Date.now() - lastPowerSpawn > 8000) {
        spawnPower();
        lastPowerSpawn = Date.now();
      }

      requestAnimationFrame(update);
    }

    // Fire bullets on touch
    canvas.addEventListener("touchstart", () => {
      bullets.push({
        x: player.x + player.width / 2 - 5,
        y: player.y,
        width: 10,
        height: 20
      });
    });

    update();
  </script>
</body>
</html>
